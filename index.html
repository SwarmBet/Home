<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwarmBet Ultimate - 1100+ Premium Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        /* CSS RESET & CORE VARIABLES */
        :root { 
            --orange: #ff9900; --dark-bg: #050505; --panel-bg: #121212; 
            --sidebar-bg: #0d0d0d; --green: #2ecc71; --red: #e74c3c; 
            --blue: #3498db; --gold: #f1c40f; --text-main: #ffffff; 
            --text-dim: #777777; --border: #222222; --accent: #ffb340;
        }

        * { box-sizing: border-box; outline: none; }
        body { 
            background-color: var(--dark-bg); color: var(--text-main); 
            font-family: 'Inter', sans-serif; margin: 0; display: flex; 
            height: 100vh; overflow: hidden; user-select: none;
        }

        /* SCROLLBAR CUSTOMIZATION */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #333; }

        /* LAYOUT COMPONENTS */
        .sidebar { 
            width: 280px; background: var(--sidebar-bg); border-right: 1px solid var(--border); 
            display: flex; flex-direction: column; padding: 30px 0; flex-shrink: 0; z-index: 1000; 
        }
        .main-container { flex: 1; display: flex; flex-direction: column; overflow-y: auto; position: relative; }
        
        /* LOGO & BRANDING */
        .brand { padding: 0 35px 50px; }
        .brand h1 { 
            font-size: 32px; font-weight: 900; margin: 0; letter-spacing: -1px; 
            background: linear-gradient(to bottom, #fff 0%, var(--orange) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* NAVIGATION */
        .nav-list { list-style: none; padding: 0; margin: 0; }
        .nav-link { 
            padding: 16px 35px; cursor: pointer; display: flex; align-items: center; 
            gap: 15px; font-weight: 700; color: var(--text-dim); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 4px solid transparent; margin-bottom: 5px;
        }
        .nav-link:hover { color: #fff; background: rgba(255, 153, 0, 0.05); }
        .nav-link.active { 
            color: var(--orange); background: rgba(255, 153, 0, 0.1); 
            border-left-color: var(--orange); 
        }

        /* TOP NAVIGATION & BALANCE */
        .header { 
            height: 90px; background: rgba(5,5,5,0.8); backdrop-filter: blur(20px);
            display: flex; align-items: center; justify-content: flex-end; 
            padding: 0 50px; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 900;
        }
        .user-balance-widget { 
            background: #111; padding: 12px 25px; border-radius: 15px; 
            border: 1px solid var(--border); display: flex; align-items: center; gap: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .star-icon { font-size: 20px; color: var(--gold); text-shadow: 0 0 10px rgba(241, 196, 15, 0.5); }
        .balance-value { font-family: 'JetBrains Mono', monospace; font-size: 20px; font-weight: 700; }

        /* CONTENT WRAPPER */
        .content { padding: 50px; max-width: 1400px; margin: 0 auto; width: 100%; }

        /* DASHBOARD - GAMES GRID */
        .games-grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); 
            gap: 25px; margin-top: 20px; 
        }
        .game-tile { 
            background: var(--panel-bg); border: 1px solid var(--border); border-radius: 25px; 
            padding: 40px 20px; text-align: center; transition: 0.4s; cursor: pointer; position: relative; overflow: hidden;
        }
        .game-tile:hover { 
            transform: translateY(-10px); border-color: var(--orange); 
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        }
        .game-tile::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,153,0,0.1) 0%, transparent 70%);
            opacity: 0; transition: 0.3s;
        }
        .game-tile:hover::after { opacity: 1; }
        .game-icon { font-size: 50px; margin-bottom: 20px; display: block; }
        .game-tile h3 { margin: 0 0 10px; font-size: 22px; font-weight: 900; letter-spacing: 1px; }
        .game-tile p { color: var(--text-dim); font-size: 13px; margin: 0; }

        /* GAME VIEWPORT & CONTROLS */
        .game-viewport { 
            background: var(--panel-bg); border: 1px solid var(--border); border-radius: 40px; 
            padding: 60px; position: relative; min-height: 700px; 
        }
        .btn-back { 
            background: none; border: 1px solid var(--border); color: var(--text-dim); 
            padding: 10px 20px; border-radius: 12px; cursor: pointer; font-weight: 700; margin-bottom: 40px;
        }
        .btn-back:hover { color: #fff; border-color: #555; }

        /* INPUTS & UNIVERSAL BUTTONS */
        .input-group { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        .input-group label { font-size: 11px; font-weight: 900; color: var(--text-dim); text-transform: uppercase; letter-spacing: 2px; }
        .bet-input { 
            background: #000; border: 2px solid var(--border); border-radius: 15px; 
            color: var(--orange); padding: 18px; font-size: 18px; font-weight: 700; width: 100%; text-align: center;
        }
        .bet-input:focus { border-color: var(--orange); }
        .btn-action { 
            background: var(--orange); color: #000; border: none; padding: 20px 40px; 
            border-radius: 15px; font-weight: 900; font-size: 16px; cursor: pointer; text-transform: uppercase;
            box-shadow: 0 10px 20px rgba(255, 153, 0, 0.3); transition: 0.2s;
        }
        .btn-action:hover { transform: scale(1.02); filter: brightness(1.1); }
        .btn-action:disabled { background: #333; color: #666; cursor: not-allowed; box-shadow: none; }

        /* --- ROULETTE STYLES --- */
        .r-board-master { max-width: 1200px; margin: 0 auto; padding: 20px; background: #0a0a0a; border-radius: 20px; }
        .r-track-container { position: relative; width: 100%; height: 110px; background: #000; border: 2px solid #222; overflow: hidden; border-radius: 15px; margin-bottom: 50px; }
        .r-track-indicator { position: absolute; left: 50%; height: 100%; width: 4px; background: #fff; z-index: 10; transform: translateX(-50%); box-shadow: 0 0 20px #fff; }
        .r-track-inner { display: flex; position: absolute; transition: transform 7s cubic-bezier(0.1, 0, 0.05, 1); }
        .r-slot { min-width: 100px; height: 110px; display: flex; items-center; justify-content: center; font-weight: 900; font-size: 34px; border-right: 1px solid rgba(255,255,255,0.05); }

        .r-layout { display: grid; grid-template-columns: 80px repeat(12, 1fr); gap: 6px; margin-bottom: 10px; }
        .r-cell { height: 65px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 20px; position: relative; transition: 0.2s; border-bottom: 4px solid rgba(0,0,0,0.3); }
        .r-cell:hover { transform: translateY(-3px); filter: brightness(1.3); }
        .r-cell.green { background: var(--green); grid-row: span 3; height: 207px; }
        .r-cell.red { background: var(--red); }
        .r-cell.black { background: #1a1a1a; }
        .r-cell.active { border: 2px solid white; box-shadow: 0 0 15px white; z-index: 20; }

        .r-outside-dozen { display: grid; grid-template-columns: 80px repeat(3, 1fr); gap: 6px; margin-bottom: 10px; }
        .r-outside-bottom { display: grid; grid-template-columns: 80px repeat(6, 1fr); gap: 6px; }
        .r-outside-cell { height: 55px; background: #222; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 800; text-transform: uppercase; color: #888; transition: 0.2s; }
        .r-outside-cell:hover { background: #333; color: #fff; }

        .chip-stack { 
            position: absolute; top: -12px; right: -12px; background: var(--orange); 
            width: 28px; height: 28px; border-radius: 50%; border: 3px dashed white; 
            color: black; font-size: 10px; font-weight: 900; display: flex; align-items: center; justify-content: center; z-index: 50;
        }

        /* --- MINES STYLES --- */
        .mines-grid { display: grid; grid-template-columns: repeat(5, 75px); gap: 12px; justify-content: center; margin: 40px auto; }
        .mines-tile { width: 75px; height: 75px; background: #1a1a1a; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 32px; border-bottom: 4px solid #000; transition: 0.2s; }
        .mines-tile:hover { background: #222; }
        .mines-tile.revealed { background: #0a0a0a; border-bottom: none; cursor: default; }

        /* --- CRASH STYLES --- */
        .crash-canvas-area { height: 350px; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        .crash-mult { font-size: 120px; font-weight: 900; font-family: 'JetBrains Mono'; color: var(--orange); text-shadow: 0 0 40px rgba(255,153,0,0.3); }

        /* --- BLACKJACK STYLES --- */
        .card-container { display: flex; gap: 15px; min-height: 150px; justify-content: center; margin: 20px 0; }
        .card { 
            width: 100px; height: 145px; background: white; border-radius: 10px; color: black; 
            display: flex; flex-direction: column; justify-content: space-between; padding: 12px;
            font-weight: 900; font-size: 22px; box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            animation: dealCard 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes dealCard { from { transform: translateY(-100px) rotate(20deg); opacity: 0; } to { transform: translateY(0) rotate(0); opacity: 1; } }
        .card.red { color: var(--red); }
        .score-badge { background: #222; padding: 5px 15px; border-radius: 20px; font-size: 12px; color: #888; font-weight: 700; margin-bottom: 10px; display: inline-block; }

        /* --- AUTH SCREEN --- */
        #auth-screen { 
            position: fixed; inset: 0; background: #050505; z-index: 9999; 
            display: flex; align-items: center; justify-content: center;
        }
        .auth-card { 
            width: 420px; background: var(--panel-bg); border: 1px solid var(--border); 
            padding: 60px; border-radius: 40px; text-align: center;
        }

        /* UTILS */
        .hidden { display: none !important; }
        .win-glow { animation: winGlow 1s ease-in-out infinite alternate; }
        @keyframes winGlow { from { text-shadow: 0 0 10px rgba(46, 204, 113, 0.5); } to { text-shadow: 0 0 30px rgba(46, 204, 113, 0.9); } }

    </style>
</head>
<body onclick="setupAudio()">

<div id="auth-screen">
    <div class="auth-card">
        <h1 style="color: var(--orange); font-size: 42px; margin-bottom: 10px;">SWARM<span>BET</span></h1>
        <p style="color: #444; font-size: 12px; letter-spacing: 4px; font-weight: 900; margin-bottom: 40px;">PREMIUM ACCESS 2026</p>
        
        <div class="input-group" style="text-align: left;">
            <label>U≈æivatelsk√© jm√©no</label>
            <input type="text" id="login-user" class="bet-input" placeholder="USERNAME" style="text-align: left; padding-left: 20px;">
        </div>
        <div class="input-group" style="text-align: left;">
            <label>P≈ô√≠stupov√© heslo</label>
            <input type="password" id="login-pass" class="bet-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" style="text-align: left; padding-left: 20px;">
        </div>

        <button class="btn-action" onclick="handleLogin()" style="width: 100%; margin-top: 20px;">Ovƒõ≈ôit & Vstoupit</button>
        <p style="margin-top: 25px; font-size: 13px; color: #333;">Vytvo≈ôen√≠m √∫ƒçtu souhlas√≠te s pravidly SwarmBet.</p>
    </div>
</div>

<div class="sidebar">
    <div class="brand"><h1>SWARMBET</h1></div>
    <ul class="nav-list">
        <li class="nav-link active" onclick="navigate('dashboard')">üè∞ Dashboard</li>
        <li class="nav-link" onclick="navigate('history')">üìú Historie s√°zek</li>
        <li class="nav-link" onclick="navigate('promo')">üéÅ Bonusov√© k√≥dy</li>
        <li class="nav-link" onclick="navigate('rankings')">üèÜ ≈Ωeb≈ô√≠ƒçek</li>
        <li id="admin-nav" class="nav-link hidden" onclick="navigate('admin')" style="color: var(--red);">‚öôÔ∏è Spr√°va syst√©mu</li>
    </ul>
    
    <div style="margin-top: auto; padding: 0 30px;">
        <div style="padding: 20px; border: 1px solid #222; border-radius: 20px; text-align: center;">
            <p style="font-size: 10px; color: #444; margin-bottom: 10px;">STATUS</p>
            <p style="font-size: 12px; color: var(--green); font-weight: 900;"><span style="display:inline-block; width:8px; height:8px; background:var(--green); border-radius:50%; margin-right:5px;"></span> SERVER ONLINE</p>
        </div>
    </div>
</div>

<div class="main-container">
    <div class="header">
        <div class="user-balance-widget">
            <span class="star-icon">‚≠ê</span>
            <span id="display-balance" class="balance-value">0</span>
        </div>
    </div>

    <div class="content">
        <div id="tab-dashboard">
            <div class="games-grid">
                <div class="game-tile" onclick="launch('roulette')">
                    <span class="game-icon">üîò</span>
                    <h3>Roulette Pro</h3>
                    <p>Klasick√° evropsk√° ruleta se v≈°emi s√°zkami.</p>
                </div>
                <div class="game-tile" onclick="launch('mines')">
                    <span class="game-icon">üí£</span>
                    <h3>Mines</h3>
                    <p>Najdi hvƒõzdy a vyhni se min√°m.</p>
                </div>
                <div class="game-tile" onclick="launch('crash')">
                    <span class="game-icon">üìà</span>
                    <h3>Crash</h3>
                    <p>Vyskoƒç vƒças, ne≈æ raketa vybuchne.</p>
                </div>
                <div class="game-tile" onclick="launch('blackjack')">
                    <span class="game-icon">üÉè</span>
                    <h3>Blackjack</h3>
                    <p>Pora≈æ krupi√©ra a tref 21.</p>
                </div>
                <div class="game-tile" onclick="launch('dice')">
                    <span class="game-icon">üé≤</span>
                    <h3>Dice</h3>
                    <p>Nastav si ≈°anci a hoƒè kostkou.</p>
                </div>
                <div class="game-tile" onclick="launch('baccarat')">
                    <span class="game-icon">üßß</span>
                    <h3>Baccarat</h3>
                    <p>S√°zej na hr√°ƒçe, bank√©≈ôe nebo rem√≠zu.</p>
                </div>
                <div class="game-tile" onclick="launch('tower')">
                    <span class="game-icon">üè∞</span>
                    <h3>Tower</h3>
                    <p>Vystoupej a≈æ na vrchol vƒõ≈æe.</p>
                </div>
                <div class="game-tile" onclick="launch('limbo')">
                    <span class="game-icon">üöÄ</span>
                    <h3>Limbo</h3>
                    <p>Tref vysok√Ω n√°sobitel.</p>
                </div>
                <div class="game-tile" onclick="launch('rps')">
                    <span class="game-icon">‚úä</span>
                    <h3>RPS</h3>
                    <p>K√°men, n≈Ø≈æky, pap√≠r proti botovi.</p>
                </div>
                <div class="game-tile" onclick="launch('coinflip')">
                    <span class="game-icon">ü™ô</span>
                    <h3>Coinflip</h3>
                    <p>Vsad si na hlavu nebo orla.</p>
                </div>
                <div class="game-tile" onclick="launch('wheel')">
                    <span class="game-icon">üé°</span>
                    <h3>Wheel</h3>
                    <p>Roztoƒç kolo ≈°tƒõst√≠.</p>
                </div>
            </div>
        </div>

        <div id="game-view" class="hidden">
            <button class="btn-back" onclick="quitGame()">‚Üê Zpƒõt do menu</button>
            <div class="game-viewport">
                
                <div id="engine-roulette" class="hidden">
                    <div class="r-board-master">
                        <div class="r-track-container">
                            <div class="r-track-indicator"></div>
                            <div id="r-wheel-track" class="r-track-inner"></div>
                        </div>

                        <div class="r-layout" id="r-numbers-grid"></div>
                        
                        <div class="r-outside-dozen">
                            <div style="width:80px"></div>
                            <div class="r-outside-cell" onclick="betR('dozen1', this)">1st 12</div>
                            <div class="r-outside-cell" onclick="betR('dozen2', this)">2nd 12</div>
                            <div class="r-outside-cell" onclick="betR('dozen3', this)">3rd 12</div>
                        </div>

                        <div class="r-outside-bottom">
                            <div style="width:80px"></div>
                            <div class="r-outside-cell" onclick="betR('low', this)">1-18</div>
                            <div class="r-outside-cell" onclick="betR('even', this)">Even</div>
                            <div class="r-outside-cell" onclick="betR('red', this)" style="background:#e74c3c; color:white;">Red</div>
                            <div class="r-outside-cell" onclick="betR('black', this)" style="background:#111; color:white;">Black</div>
                            <div class="r-outside-cell" onclick="betR('odd', this)">Odd</div>
                            <div class="r-outside-cell" onclick="betR('high', this)">19-36</div>
                        </div>

                        <div style="display:flex; justify-content:center; gap:20px; margin-top:50px;">
                            <div style="width: 250px;">
                                <label style="font-size:10px; color:#555; font-weight:900;">ƒå√ÅSTKA S√ÅZKY</label>
                                <input type="number" id="r-amount" class="bet-input" value="100">
                            </div>
                            <button class="btn-action" id="r-spin-btn" onclick="spinRoulette()" style="margin-top:21px;">Spin</button>
                            <button class="btn-action" onclick="clearRoulette()" style="margin-top:21px; background:#222; color:#fff;">Clear</button>
                        </div>
                    </div>
                </div>

                <div id="engine-mines" class="hidden">
                    <h2 style="text-align:center;">MINES</h2>
                    <div class="mines-grid" id="mines-board"></div>
                    <div style="display:flex; justify-content:center; gap:20px;">
                        <div style="width: 200px;">
                            <label style="font-size:10px; color:#555; font-weight:900;">S√ÅZKA</label>
                            <input type="number" id="m-amount" class="bet-input" value="100">
                        </div>
                        <button class="btn-action" id="m-start-btn" onclick="startMines()" style="margin-top:21px;">H√°t</button>
                        <button class="btn-action hidden" id="m-cash-btn" onclick="cashoutMines()" style="margin-top:21px; background:var(--green);">Cashout</button>
                    </div>
                    <p id="m-status" style="text-align:center; margin-top:20px; color:var(--text-dim);"></p>
                </div>

                <div id="engine-blackjack" class="hidden">
                    <div style="text-align:center;">
                        <div class="score-badge">Dealerova ruka</div>
                        <div id="bj-dealer-cards" class="card-container"></div>
                        <div style="margin:40px 0;">
                            <h1 id="bj-result-text" style="font-size:48px;">Vsaƒète pro start</h1>
                        </div>
                        <div class="score-badge">Va≈°e ruka (<span id="bj-my-score">0</span>)</div>
                        <div id="bj-my-cards" class="card-container"></div>
                        
                        <div style="display:flex; justify-content:center; gap:15px; margin-top:40px;">
                            <input type="number" id="bj-amount" class="bet-input" value="100" style="width:150px;">
                            <button class="btn-action" id="bj-deal-btn" onclick="startBJ()">Rozdat</button>
                            <button class="btn-action hidden" id="bj-hit-btn" onclick="hitBJ()">Hit</button>
                            <button class="btn-action hidden" id="bj-stand-btn" onclick="standBJ()" style="background:#555;">Stand</button>
                        </div>
                    </div>
                </div>

                <div id="engine-crash" class="hidden">
                    <div class="crash-canvas-area">
                        <div id="crash-multiplier" class="crash-mult">1.00x</div>
                    </div>
                    <div style="display:flex; justify-content:center; gap:20px; margin-top:30px;">
                        <input type="number" id="c-amount" class="bet-input" value="100" style="width:200px;">
                        <button class="btn-action" id="c-start-btn" onclick="startCrash()">Bet</button>
                        <button class="btn-action hidden" id="c-cash-btn" onclick="cashoutCrash()" style="background:var(--green);">Cashout</button>
                    </div>
                </div>

                </div>
        </div>

        <div id="tab-history" class="hidden">
            <h2 style="margin-bottom:30px;">Historie tv√Ωch aktivit</h2>
            <div style="background:var(--panel-bg); border-radius:30px; border:1px solid var(--border); overflow:hidden;">
                <table style="width:100%; border-collapse:collapse; text-align:left;">
                    <thead style="background:#0a0a0a; color:#555; font-size:12px; font-weight:900;">
                        <tr>
                            <th style="padding:20px;">HRA</th>
                            <th>S√ÅZKA</th>
                            <th>N√ÅSOBITEL</th>
                            <th>V√ùSLEDEK</th>
                            <th>ƒåAS</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body"></tbody>
                </table>
            </div>
        </div>

        <div id="tab-promo" class="hidden">
            <div style="max-width:500px; margin: 0 auto; text-align:center;">
                <h2>Bonusov√© k√≥dy</h2>
                <p style="color:#555; margin-bottom:40px;">Sleduj n√°≈° Discord pro nejnovƒõj≈°√≠ promo k√≥dy!</p>
                <input type="text" id="promo-input" class="bet-input" placeholder="Zadej k√≥d..." style="margin-bottom:20px;">
                <button class="btn-action" onclick="claimPromo()" style="width:100%;">Aktivovat bonus</button>
            </div>
        </div>

        <div id="tab-admin" class="hidden">
            <h2 style="color:var(--red);">Administr√°torsk√Ω ovl√°dac√≠ panel</h2>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:30px; margin-top:30px;">
                <div style="background:var(--panel-bg); padding:30px; border-radius:20px; border:1px solid var(--red);">
                    <h3>Manipulace s kredity</h3>
                    <input type="text" id="adm-user" class="bet-input" placeholder="U≈æivatel" style="margin-bottom:10px;">
                    <input type="number" id="adm-amt" class="bet-input" placeholder="Mno≈æstv√≠ +/-">
                    <button class="btn-action" onclick="adminMod()" style="width:100%; margin-top:20px; background:var(--red); color:white;">Upravit balanc</button>
                </div>
                <div style="background:var(--panel-bg); padding:30px; border-radius:20px; border:1px solid var(--green);">
                    <h3>Vytvo≈ôit Promo K√≥d</h3>
                    <input type="text" id="adm-code" class="bet-input" placeholder="N√°zev k√≥du" style="margin-bottom:10px;">
                    <input type="number" id="adm-val" class="bet-input" placeholder="Hodnota Stars">
                    <button class="btn-action" onclick="adminPromo()" style="width:100%; margin-top:20px; background:var(--green); color:white;">Generovat k√≥d</button>
                </div>
            </div>
        </div>

    </div>
</div>

<div id="win-announcement" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:10000; display:flex; align-items:center; justify-content:center; pointer-events:none;">
    <div style="text-align:center; animation: winPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);">
        <h1 style="color:var(--gold); font-size:120px; margin:0; line-height:1;" id="win-mult-text">2.00x</h1>
        <h2 style="color:white; font-size:40px; margin:0;" id="win-amt-text">+500 ‚≠ê</h2>
    </div>
</div>

<script>
    /* -------------------------------------------------------------------------
       CORE CONFIGURATION & STATE
       ------------------------------------------------------------------------- */
    const DATABASE_URL = "https://casbss-c75a0-default-rtdb.europe-west1.firebasedatabase.app";
    let user = null;
    let balance = 0;
    let currentTab = 'dashboard';
    let currentGame = null;
    let audioContext = null;

    // Roulette configuration
    const R_ORDER = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
    const R_REDS = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
    let rouletteBets = {};
    let isSpinning = false;

    /* -------------------------------------------------------------------------
       SYSTEM INITIALIZATION
       ------------------------------------------------------------------------- */
    function setupAudio() {
        if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }

    function playSound(freq, type, dur) {
        if(!audioContext) return;
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioContext.currentTime);
        gain.gain.setValueAtTime(0.1, audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + dur);
        osc.connect(gain);
        gain.connect(audioContext.destination);
        osc.start();
        osc.stop(audioContext.currentTime + dur);
    }

    /* -------------------------------------------------------------------------
       AUTHENTICATION & DATA
       ------------------------------------------------------------------------- */
    async function handleLogin() {
        const u = document.getElementById('login-user').value.trim();
        const p = document.getElementById('login-pass').value;
        if(!u || !p) return alert("Vypl≈àte √∫daje!");

        try {
            const res = await fetch(`${DATABASE_URL}/users/${u}.json`);
            let data = await res.json();

            if(!data) {
                // Register new
                data = { password: p, chips: 5000, rank: 'Player', history: [] };
                await fetch(`${DATABASE_URL}/users/${u}.json`, { method: 'PUT', body: JSON.stringify(data) });
            } else if(data.password !== p) {
                return alert("Nespr√°vn√© heslo!");
            }

            user = u;
            balance = data.chips;
            document.getElementById('auth-screen').classList.add('hidden');
            updateUI();
            
            if(['sepiak', 'admin', 'artur'].includes(u.toLowerCase())) {
                document.getElementById('admin-nav').classList.remove('hidden');
            }
            
            buildRouletteBoard();
        } catch(e) { alert("Chyba spojen√≠!"); }
    }

    function updateUI() {
        document.getElementById('display-balance').innerText = Math.floor(balance).toLocaleString();
        // Sync to DB
        if(user) fetch(`${DATABASE_URL}/users/${user}/chips.json`, { method: 'PUT', body: balance });
    }

    function navigate(tab) {
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        document.getElementById('tab-' + currentTab)?.classList.add('hidden');
        
        currentTab = tab;
        document.getElementById('tab-' + tab).classList.remove('hidden');
        // Find link with text and add active
        const links = document.querySelectorAll('.nav-link');
        links.forEach(l => { if(l.innerText.toLowerCase().includes(tab)) l.classList.add('active'); });

        if(tab === 'history') loadHistory();
    }

    /* -------------------------------------------------------------------------
       ROULETTE ENGINE - FIXNUTO & ROZ≈†√ç≈òENO
       ------------------------------------------------------------------------- */
    function buildRouletteBoard() {
        const track = document.getElementById('r-wheel-track');
        let trackHtml = "";
        for(let i=0; i<15; i++) {
            R_ORDER.forEach(n => {
                const color = n === 0 ? 'var(--green)' : (R_REDS.includes(n) ? 'var(--red)' : '#1a1a1a');
                trackHtml += `<div class="r-slot" style="background:${color}">${n}</div>`;
            });
        }
        track.innerHTML = trackHtml;

        const grid = document.getElementById('r-numbers-grid');
        let gridHtml = `<div class="r-cell green" onclick="betR('n0', this)">0</div>`;
        for(let col=1; col<=12; col++) {
            for(let row=3; row>=1; row--) {
                const n = (col-1)*3 + row;
                const color = R_REDS.includes(n) ? 'red' : 'black';
                gridHtml += `<div class="r-cell ${color}" onclick="betR('n${n}', this)">${n}</div>`;
            }
        }
        grid.innerHTML = gridHtml;
    }

    function betR(type, el) {
        if(isSpinning) return;
        const amt = parseInt(document.getElementById('r-amount').value);
        if(amt > balance || amt <= 0) return;

        balance -= amt;
        updateUI();
        rouletteBets[type] = (rouletteBets[type] || 0) + amt;

        let chip = el.querySelector('.chip-stack');
        if(!chip) {
            chip = document.createElement('div');
            chip.className = 'chip-stack';
            el.appendChild(chip);
        }
        chip.innerText = rouletteBets[type] > 999 ? (rouletteBets[type]/1000).toFixed(1)+'k' : rouletteBets[type];
        el.classList.add('active');
        playSound(440, 'sine', 0.05);
    }

    function clearRoulette() {
        if(isSpinning) return;
        for(let key in rouletteBets) balance += rouletteBets[key];
        rouletteBets = {};
        document.querySelectorAll('.r-cell, .r-outside-cell').forEach(el => {
            el.classList.remove('active');
            const c = el.querySelector('.chip-stack');
            if(c) c.remove();
        });
        updateUI();
    }

    function spinRoulette() {
        if(isSpinning || Object.keys(rouletteBets).length === 0) return;
        isSpinning = true;
        document.getElementById('r-spin-btn').disabled = true;

        const winIdx = Math.floor(Math.random() * R_ORDER.length);
        const winNum = R_ORDER[winIdx];
        const slotWidth = 100;
        const totalSlots = R_ORDER.length * 15;
        const offset = ((8 * R_ORDER.length) + winIdx) * slotWidth;
        const center = document.querySelector('.r-track-container').offsetWidth / 2 - (slotWidth/2);
        
        document.getElementById('r-wheel-track').style.transform = `translateX(${-offset + center}px)`;

        setTimeout(() => {
            let winTotal = 0;
            let betTotal = 0;

            for(let key in rouletteBets) {
                const amt = rouletteBets[key];
                betTotal += amt;
                
                // Logic evaluation
                if(key === 'n'+winNum) winTotal += amt * 36;
                else if(key === 'red' && R_REDS.includes(winNum)) winTotal += amt * 2;
                else if(key === 'black' && winNum !== 0 && !R_REDS.includes(winNum)) winTotal += amt * 2;
                else if(key === 'even' && winNum !== 0 && winNum % 2 === 0) winTotal += amt * 2;
                else if(key === 'odd' && winNum % 2 !== 0) winTotal += amt * 2;
                else if(key === 'low' && winNum >= 1 && winNum <= 18) winTotal += amt * 2;
                else if(key === 'high' && winNum >= 19 && winNum <= 36) winTotal += amt * 2;
                else if(key === 'dozen1' && winNum >= 1 && winNum <= 12) winTotal += amt * 3;
                else if(key === 'dozen2' && winNum >= 13 && winNum <= 24) winTotal += amt * 3;
                else if(key === 'dozen3' && winNum >= 25 && winNum <= 36) winTotal += amt * 3;
            }

            if(winTotal > 0) {
                balance += winTotal;
                showWin(winTotal / betTotal, winTotal);
                addHistory("Roulette", betTotal, winTotal / betTotal, winTotal);
            } else {
                addHistory("Roulette", betTotal, 0, -betTotal);
                playSound(150, 'sawtooth', 0.3);
            }

            isSpinning = false;
            document.getElementById('r-spin-btn').disabled = false;
            updateUI();
            // Reset board visually after 3s
            setTimeout(() => {
                rouletteBets = {};
                document.querySelectorAll('.r-cell, .r-outside-cell').forEach(el => {
                    el.classList.remove('active');
                    if(el.querySelector('.chip-stack')) el.querySelector('.chip-stack').remove();
                });
            }, 2000);
        }, 7500);
    }

    /* -------------------------------------------------------------------------
       MINES ENGINE
       ------------------------------------------------------------------------- */
    let minesActive = false, mBet = 0, mBombs = [], mRevealed = 0;
    function startMines() {
        mBet = parseInt(document.getElementById('m-amount').value);
        if(mBet > balance || mBet <= 0) return;
        balance -= mBet;
        updateUI();
        
        minesActive = true;
        mRevealed = 0;
        mBombs = [];
        while(mBombs.length < 3) {
            let r = Math.floor(Math.random() * 25);
            if(!mBombs.includes(r)) mBombs.push(r);
        }

        document.getElementById('m-start-btn').disabled = true;
        document.getElementById('m-cash-btn').classList.remove('hidden');
        
        const board = document.getElementById('mines-board');
        board.innerHTML = "";
        for(let i=0; i<25; i++) {
            const t = document.createElement('div');
            t.className = 'mines-tile';
            t.onclick = () => clickMine(i, t);
            board.appendChild(t);
        }
    }

    function clickMine(idx, el) {
        if(!minesActive || el.classList.contains('revealed')) return;
        el.classList.add('revealed');
        
        if(mBombs.includes(idx)) {
            el.innerHTML = "üí•";
            el.style.background = "var(--red)";
            minesActive = false;
            addHistory("Mines", mBet, 0, -mBet);
            document.getElementById('m-start-btn').disabled = false;
            document.getElementById('m-cash-btn').classList.add('hidden');
            playSound(100, 'square', 0.4);
        } else {
            el.innerHTML = "‚≠ê";
            el.style.color = "var(--gold)";
            mRevealed++;
            playSound(600 + (mRevealed * 50), 'sine', 0.1);
            let mult = calculateMinesMult();
            document.getElementById('m-status').innerText = `Current: ${mult.toFixed(2)}x`;
        }
    }

    function calculateMinesMult() {
        // Simple fair math for 3 bombs
        let n = 25, k = 3, r = mRevealed;
        // probability = ( (n-k)Cr ) / ( nCr )
        function combinations(n, k) {
            if(k<0 || k>n) return 0;
            if(k===0 || k===n) return 1;
            let res = 1;
            for(let i=1; i<=k; i++) res = res * (n-i+1) / i;
            return res;
        }
        let prob = combinations(n-k, r) / combinations(n, r);
        return (0.98 / prob);
    }

    function cashoutMines() {
        if(!minesActive || mRevealed === 0) return;
        let mult = calculateMinesMult();
        let win = mBet * mult;
        balance += win;
        showWin(mult, win);
        addHistory("Mines", mBet, mult, win);
        minesActive = false;
        updateUI();
        document.getElementById('m-start-btn').disabled = false;
        document.getElementById('m-cash-btn').classList.add('hidden');
    }

    /* -------------------------------------------------------------------------
       BLACKJACK ENGINE
       ------------------------------------------------------------------------- */
    let bjDeck = [], bjMyHand = [], bjDealerHand = [], bjActive = false, bjBet = 0;
    function startBJ() {
        bjBet = parseInt(document.getElementById('bj-amount').value);
        if(bjBet > balance || bjBet <= 0) return;
        balance -= bjBet;
        updateUI();

        bjActive = true;
        bjDeck = createDeck();
        bjMyHand = [bjDeck.pop(), bjDeck.pop()];
        bjDealerHand = [bjDeck.pop(), bjDeck.pop()];

        document.getElementById('bj-deal-btn').classList.add('hidden');
        document.getElementById('bj-hit-btn').classList.remove('hidden');
        document.getElementById('bj-stand-btn').classList.remove('hidden');
        document.getElementById('bj-result-text').innerText = "Hrajte...";

        renderBJ();
    }

    function createDeck() {
        const suits = ['‚ô†', '‚ô£', '‚ô•', '‚ô¶'];
        const values = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
        let d = [];
        suits.forEach(s => values.forEach(v => d.push({v, s, color: (s==='‚ô•'||s==='‚ô¶'?'red':'black')})));
        return d.sort(() => Math.random() - 0.5);
    }

    function getBJScore(hand) {
        let score = 0, aces = 0;
        hand.forEach(c => {
            if(c.v === 'A') aces++;
            else if(['J','Q','K'].includes(c.v)) score += 10;
            else score += parseInt(c.v);
        });
        for(let i=0; i<aces; i++) score += (score + 11 <= 21) ? 11 : 1;
        return score;
    }

    function renderBJ() {
        const myContainer = document.getElementById('bj-my-cards');
        const dContainer = document.getElementById('bj-dealer-cards');
        myContainer.innerHTML = ""; dContainer.innerHTML = "";

        bjMyHand.forEach(c => myContainer.innerHTML += `<div class="card ${c.color}"><span>${c.v}</span><span style="font-size:40px; align-self:center;">${c.s}</span><span style="align-self:flex-end;">${c.v}</span></div>`);
        
        if(bjActive) {
            dContainer.innerHTML += `<div class="card ${bjDealerHand[0].color}"><span>${bjDealerHand[0].v}</span><span style="font-size:40px; align-self:center;">${bjDealerHand[0].s}</span><span style="align-self:flex-end;">${bjDealerHand[0].v}</span></div>`;
            dContainer.innerHTML += `<div class="card" style="background:#222; border: 1px solid #444;"></div>`;
        } else {
            bjDealerHand.forEach(c => dContainer.innerHTML += `<div class="card ${c.color}"><span>${c.v}</span><span style="font-size:40px; align-self:center;">${c.s}</span><span style="align-self:flex-end;">${c.v}</span></div>`);
        }

        document.getElementById('bj-my-score').innerText = getBJScore(bjMyHand);
    }

    function hitBJ() {
        if(!bjActive) return;
        bjMyHand.push(bjDeck.pop());
        renderBJ();
        if(getBJScore(bjMyHand) > 21) standBJ();
    }

    function standBJ() {
        if(!bjActive) return;
        bjActive = false;
        
        let dScore = getBJScore(bjDealerHand);
        while(dScore < 17) {
            bjDealerHand.push(bjDeck.pop());
            dScore = getBJScore(bjDealerHand);
        }
        
        renderBJ();
        const pScore = getBJScore(bjMyHand);
        let result = "";

        if(pScore > 21) {
            result = "BUST! Prohra.";
            addHistory("Blackjack", bjBet, 0, -bjBet);
        } else if(dScore > 21 || pScore > dScore) {
            result = "V√ùHRA!";
            balance += bjBet * 2;
            showWin(2, bjBet * 2);
            addHistory("Blackjack", bjBet, 2, bjBet * 2);
        } else if(pScore === dScore) {
            result = "PUSH - Rem√≠za";
            balance += bjBet;
        } else {
            result = "Dealer vyhr√°l.";
            addHistory("Blackjack", bjBet, 0, -bjBet);
        }

        document.getElementById('bj-result-text').innerText = result;
        document.getElementById('bj-deal-btn').classList.remove('hidden');
        document.getElementById('bj-hit-btn').classList.add('hidden');
        document.getElementById('bj-stand-btn').classList.add('hidden');
        updateUI();
    }

    /* -------------------------------------------------------------------------
       CRASH ENGINE
       ------------------------------------------------------------------------- */
    let crashActive = false, cMult = 1.0, cInt, cBet = 0;
    function startCrash() {
        cBet = parseInt(document.getElementById('c-amount').value);
        if(cBet > balance || cBet <= 0) return;
        balance -= cBet;
        updateUI();

        crashActive = true;
        cMult = 1.0;
        document.getElementById('c-start-btn').disabled = true;
        document.getElementById('c-cash-btn').classList.remove('hidden');

        // Fair crash point logic
        let crashAt = (Math.random() < 0.03) ? 1.00 : (0.99 / (1 - Math.random()));

        cInt = setInterval(() => {
            cMult += 0.01 * (cMult / 1.5);
            document.getElementById('crash-multiplier').innerText = cMult.toFixed(2) + "x";
            
            if(cMult >= crashAt) {
                clearInterval(cInt);
                crashActive = false;
                document.getElementById('crash-multiplier').style.color = "var(--red)";
                document.getElementById('c-start-btn').disabled = false;
                document.getElementById('c-cash-btn').classList.add('hidden');
                addHistory("Crash", cBet, 0, -cBet);
                playSound(100, 'sawtooth', 0.5);
                setTimeout(() => document.getElementById('crash-multiplier').style.color = "var(--orange)", 2000);
            }
        }, 80);
    }

    function cashoutCrash() {
        if(!crashActive) return;
        clearInterval(cInt);
        crashActive = false;
        let win = cBet * cMult;
        balance += win;
        showWin(cMult, win);
        addHistory("Crash", cBet, cMult, win);
        updateUI();
        document.getElementById('c-start-btn').disabled = false;
        document.getElementById('c-cash-btn').classList.add('hidden');
    }

    /* -------------------------------------------------------------------------
       UTILITIES & SYSTEM FUNCTIONS
       ------------------------------------------------------------------------- */
    function launch(game) {
        document.getElementById('tab-dashboard').classList.add('hidden');
        document.getElementById('game-view').classList.remove('hidden');
        
        // Hide all engines
        ['roulette','mines','blackjack','crash'].forEach(id => {
            document.getElementById('engine-'+id)?.classList.add('hidden');
        });
        
        document.getElementById('engine-'+game).classList.remove('hidden');
        currentGame = game;
    }

    function quitGame() {
        document.getElementById('tab-dashboard').classList.remove('hidden');
        document.getElementById('game-view').classList.add('hidden');
        if(crashActive) cashoutCrash();
        currentGame = null;
    }

    function showWin(mult, amt) {
        const overlay = document.getElementById('win-announcement');
        document.getElementById('win-mult-text').innerText = mult.toFixed(2) + "x";
        document.getElementById('win-amt-text').innerText = "+" + Math.floor(amt).toLocaleString() + " ‚≠ê";
        overlay.classList.remove('hidden');
        playSound(800, 'sine', 0.5);
        setTimeout(() => overlay.classList.add('hidden'), 2500);
    }

    function addHistory(game, bet, mult, win) {
        const log = { game, bet, mult, win, time: new Date().toLocaleTimeString() };
        fetch(`${DATABASE_URL}/users/${user}/history.json`, { 
            method: 'POST', 
            body: JSON.stringify(log) 
        });
    }

    async function loadHistory() {
        const res = await fetch(`${DATABASE_URL}/users/${user}/history.json`);
        const data = await res.json();
        const tbody = document.getElementById('history-table-body');
        tbody.innerHTML = "";
        
        if(!data) return;
        Object.values(data).reverse().slice(0, 15).forEach(h => {
            tbody.innerHTML += `
                <tr style="border-bottom:1px solid #111;">
                    <td style="padding:15px; font-weight:900;">${h.game}</td>
                    <td>${h.bet}</td>
                    <td style="color:var(--orange)">${h.mult.toFixed(2)}x</td>
                    <td style="color:${h.win > 0 ? 'var(--green)' : 'var(--red)'}; font-weight:900;">${h.win > 0 ? '+'+h.win : h.win}</td>
                    <td style="color:#444; font-size:10px;">${h.time}</td>
                </tr>
            `;
        });
    }

    // Admin Panel Functions
    async function adminMod() {
        const target = document.getElementById('adm-user').value;
        const amt = parseInt(document.getElementById('adm-amt').value);
        const res = await fetch(`${DATABASE_URL}/users/${target}/chips.json`);
        let current = await res.json();
        await fetch(`${DATABASE_URL}/users/${target}/chips.json`, { method: 'PUT', body: (current + amt) });
        alert("Hotovo.");
    }

    async function adminPromo() {
        const code = document.getElementById('adm-code').value.toUpperCase();
        const val = parseInt(document.getElementById('adm-val').value);
        await fetch(`${DATABASE_URL}/promos/${code}.json`, { method: 'PUT', body: val });
        alert("K√≥d vytvo≈ôen.");
    }

    async function claimPromo() {
        const code = document.getElementById('promo-input').value.toUpperCase();
        const res = await fetch(`${DATABASE_URL}/promos/${code}.json`);
        const val = await res.json();
        if(val) {
            balance += val;
            updateUI();
            alert("Z√≠sk√°no " + val + " Stars!");
            await fetch(`${DATABASE_URL}/promos/${code}.json`, { method: 'DELETE' });
        } else alert("Neplatn√Ω k√≥d.");
    }
</script>
</body>
</html>
