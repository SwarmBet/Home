<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>SwarmBet - Online Casino</title>
    <style>
        :root { --accent: #ffcc00; --bg: #0d0d0d; --card: #1a1a1a; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; justify-content: center; }
        .container { width: 480px; background: var(--card); border: 2px solid #333; border-radius: 15px; padding: 20px; margin: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* Branding */
        .brand { text-align: center; color: var(--accent); font-size: 28px; font-weight: 900; letter-spacing: -1px; margin-bottom: 5px; }
        .brand span { color: white; }

        .nav { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin: 15px 0; }
        button { background: #222; color: white; border: 1px solid #444; padding: 10px 5px; border-radius: 8px; cursor: pointer; font-size: 11px; font-weight: bold; transition: 0.1s; }
        button:hover:not(:disabled) { border-color: var(--accent); background: #2a2a2a; }
        button:disabled { opacity: 0.3; cursor: not-allowed; }
        .btn-main { background: var(--accent); color: black; border: none; }

        .game-section { background: rgba(255,255,255,0.02); padding: 15px; border-radius: 12px; min-height: 280px; text-align: center; border: 1px solid #222; }
        .hidden { display: none !important; }
        
        /* Mines */
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin: 15px auto; width: 280px; }
        .tile { width: 50px; height: 50px; background: #333; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 22px; transition: 0.1s; }
        .tile.gem { background: #27ae60; box-shadow: inset 0 0 10px #2ecc71; }
        .tile.bomb { background: #c0392b; box-shadow: inset 0 0 10px #e74c3c; }

        /* Blackjack */
        .hand { display: flex; justify-content: center; gap: 8px; margin: 10px 0; height: 80px; }
        .card { width: 55px; height: 80px; background: white; color: black; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; animation: pop 0.2s; }

        @keyframes pop { 0% {transform: scale(0.7);} 100% {transform: scale(1);} }
        input { background: #000; color: var(--accent); border: 1px solid #444; padding: 8px; border-radius: 6px; text-align: center; font-weight: bold; }
        #admin-panel { border: 1px dashed #444; padding: 10px; margin-top: 20px; }
    </style>
</head>
<body onclick="initAudio()">

<div class="container">
    <div id="loading" style="text-align:center; padding: 50px;"><h2>SWARM<span>BET</span></h2><p>Naƒç√≠t√°n√≠...</p></div>

    <div id="auth-ui" class="hidden">
        <div class="brand">SWARM<span>BET</span></div>
        <p style="text-align:center; color:#666; font-size:13px;">Online Casino System</p>
        <input type="text" id="user" placeholder="U≈æivatelsk√© jm√©no" style="width:90%; margin-bottom:10px;"><br>
        <input type="password" id="pass" placeholder="Heslo" style="width:90%; margin-bottom:10px;"><br>
        <button class="btn-main" onclick="auth('login')" style="width:45%; padding:12px;">P≈òIHL√ÅSIT</button>
        <button onclick="auth('reg')" style="width:45%; padding:12px;">REGISTRACE</button>
    </div>

    <div id="game-ui" class="hidden">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <div class="brand" style="font-size:20px; margin:0;">S<span>B</span></div>
            <div style="text-align:right;">
                <div id="display-name" style="font-size:12px; color:#666;"></div>
                <div style="font-size:20px; color:var(--accent); font-weight:bold;">üí∞ <span id="display-chips">0</span></div>
            </div>
        </div>

        <div class="nav">
            <button onclick="tab('mines')">MINES</button>
            <button onclick="tab('dice')">DICE</button>
            <button onclick="tab('bj')">BJ</button>
            <button onclick="logout()" style="color:#ff4444; border-color: #400;">LOGOUT</button>
        </div>

        <div id="status" style="color:var(--accent); text-align:center; font-weight:bold; margin-bottom:10px; height:20px;"></div>

        <div id="sec-mines" class="game-section">
            <div style="margin-bottom:10px;">
                Miny: <input type="number" id="mine-count" value="3" min="1" max="24" style="width:40px;">
                S√°zka: <input type="number" id="mine-bet" value="10" style="width:80px;">
                <button id="btn-mines-start" class="btn-main" onclick="startMines()">HR√ÅT</button>
            </div>
            <div class="grid" id="mines-board"></div>
            <button id="mines-cashout" class="hidden" onclick="cashoutMines()" style="background:#27ae60; color:white; width:100%; padding:12px; border:none;">VYBRAT (CASHOUT)</button>
        </div>

        <div id="sec-dice" class="game-section hidden">
            <h3>DICE ROLL</h3>
            <p>Tipni ƒç√≠slo a vyhraj 6x!</p>
            <input type="number" id="dice-num" min="1" max="6" value="1" style="width:40px;">
            S√°zka: <input type="number" id="dice-bet" value="10" style="width:80px;">
            <button id="btn-dice-start" class="btn-main" onclick="playDice()">HODIT</button>
            <h1 id="dice-result" style="font-size:80px; margin:20px;">üé≤</h1>
        </div>

        <div id="sec-bj" class="game-section hidden">
            <h3>BLACKJACK</h3>
            <div id="bj-setup">
                S√°zka: <input type="number" id="bj-bet" value="10" style="width:80px;">
                <button class="btn-main" onclick="startBJ()" id="bj-btn-start">ROZDAT</button>
            </div>
            <div id="bj-play" class="hidden">
                <div id="d-hand" class="hand"></div>
                <div id="p-hand" class="hand"></div>
                <div id="bj-actions">
                    <button class="btn-main" onclick="bjAction('hit')" style="padding:15px 30px;">HIT</button>
                    <button onclick="bjAction('stand')" style="padding:15px 30px;">STAND</button>
                </div>
            </div>
        </div>

        <div id="admin-panel" class="hidden">
            <input type="text" id="admin-cmd" placeholder="/give jm√©no ƒç√°stka" style="width:90%" onkeypress="adminKey(event)">
        </div>
    </div>
</div>

<script>
    const DB_URL = "https://casbss-c75a0-default-rtdb.europe-west1.firebasedatabase.app/users";
    let currentUser = localStorage.getItem('swarm_user');
    let userData = null;
    let audioInited = false;

    // --- ZVUKOV√ù ENGINE ---
    const sounds = {
        click: "https://actions.google.com/sounds/v1/foley/button_click.ogg",
        win: "https://actions.google.com/sounds/v1/cartoon/clime_up_the_ladder.ogg",
        lose: "https://actions.google.com/sounds/v1/cartoon/boing.ogg",
        boom: "https://actions.google.com/sounds/v1/foley/clash_clutter.ogg",
        gem: "https://actions.google.com/sounds/v1/foley/electric_guitar_strum.ogg"
    };
    const audioNodes = {};

    function initAudio() {
        if(audioInited) return;
        for(let s in sounds) {
            audioNodes[s] = new Audio(sounds[s]);
            audioNodes[s].load();
        }
        audioInited = true;
    }

    function play(s) {
        if(!audioNodes[s]) return;
        audioNodes[s].currentTime = 0;
        audioNodes[s].play().catch(()=>{});
    }

    // --- AUTH & SERVER ---
    window.onload = async () => {
        if(currentUser) {
            const r = await fetch(`${DB_URL}/${currentUser}.json`);
            userData = await r.json();
            if(userData) loginSuccess(); else showAuth();
        } else showAuth();
    };

    function showAuth() { document.getElementById('loading').classList.add('hidden'); document.getElementById('auth-ui').classList.remove('hidden'); }

    async function auth(type) {
        const u = document.getElementById('user').value.trim();
        const p = document.getElementById('pass').value;
        if(!u || !p) return;
        const res = await fetch(DB_URL + ".json");
        const users = await res.json() || {};

        if(type === 'reg') {
            if(users[u]) return alert("Jm√©no je obsazen√©!");
            userData = { password: p, chips: 500 }; // Bonus 500 do startu
            await fetch(`${DB_URL}/${u}.json`, { method: 'PUT', body: JSON.stringify(userData) });
            alert("Registrace OK! Teƒè se p≈ôihlas.");
        } else {
            if(users[u] && users[u].password === p) {
                currentUser = u; userData = users[u];
                localStorage.setItem('swarm_user', u);
                loginSuccess();
            } else alert("≈†patn√© √∫daje!");
        }
    }

    function loginSuccess() {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('auth-ui').classList.add('hidden');
        document.getElementById('game-ui').classList.remove('hidden');
        document.getElementById('display-name').innerText = "@" + currentUser;
        if(currentUser === "skibiditoilet") document.getElementById('admin-panel').classList.remove('hidden');
        updateUI();
    }

    async function updateUI() {
        document.getElementById('display-chips').innerText = Math.floor(userData.chips);
        await fetch(`${DB_URL}/${currentUser}.json`, { method: 'PUT', body: JSON.stringify(userData) });
    }

    function tab(name) { play('click'); document.querySelectorAll('.game-section').forEach(s => s.classList.add('hidden')); document.getElementById('sec-' + name).classList.remove('hidden'); }
    function logout() { localStorage.removeItem('swarm_user'); location.reload(); }

    // --- MINES LOGIC (FIXED) ---
    let mActive = false, mBoard = [], mMult = 1, mBet = 0, mRev = 0;
    function startMines() {
        mBet = parseInt(document.getElementById('mine-bet').value);
        let count = parseInt(document.getElementById('mine-count').value);
        if(mBet > userData.chips || mBet <= 0) return alert("Nedostatek ≈æeton≈Ø!");

        mActive = true; mRev = 0; mMult = 1;
        userData.chips -= mBet; updateUI();
        
        document.getElementById('btn-mines-start').disabled = true;
        document.getElementById('mines-board').innerHTML = '';
        document.getElementById('status').innerText = "Hra zaƒçala...";

        mBoard = new Array(25).fill(false);
        let m = 0; while(m < count) { let r = Math.floor(Math.random()*25); if(!mBoard[r]){mBoard[r]=true; m++;} }

        for(let i=0; i<25; i++) {
            let t = document.createElement('div'); t.className = 'tile';
            t.onclick = () => {
                if(!mActive || t.innerHTML !== "") return;
                if(mBoard[i]) {
                    t.innerHTML = 'üí£'; t.classList.add('bomb');
                    mActive = false; play('boom');
                    resetMines("BOOM! Prohra.");
                } else {
                    t.innerHTML = 'üíé'; t.classList.add('gem');
                    mRev++; play('gem');
                    mMult *= (1 + (count / (25 - mRev)));
                    document.getElementById('status').innerText = mMult.toFixed(2) + "x";
                    document.getElementById('mines-cashout').classList.remove('hidden');
                }
            };
            document.getElementById('mines-board').appendChild(t);
        }
    }
    function cashoutMines() {
        if(!mActive) return;
        let win = Math.floor(mBet * mMult);
        userData.chips += win; play('win');
        resetMines("VYHR√ÅL JSI " + win);
        updateUI();
    }
    function resetMines(txt) {
        mActive = false;
        document.getElementById('status').innerText = txt;
        document.getElementById('mines-cashout').classList.add('hidden');
        document.getElementById('btn-mines-start').disabled = false;
    }

    // --- DICE LOGIC (FIXED) ---
    function playDice() {
        let b = parseInt(document.getElementById('dice-bet').value);
        let n = parseInt(document.getElementById('dice-num').value);
        if(b > userData.chips) return alert("M√°lo ≈æeton≈Ø!");

        document.getElementById('btn-dice-start').disabled = true;
        userData.chips -= b; updateUI();
        document.getElementById('dice-result').innerText = "‚è≥";
        
        setTimeout(() => {
            let r = Math.floor(Math.random()*6)+1;
            document.getElementById('dice-result').innerText = r;
            if(r === n) { userData.chips += b * 6; play('win'); document.getElementById('status').innerText = "V√ùHRA!"; } 
            else { play('lose'); document.getElementById('status').innerText = "PROHRA"; }
            updateUI();
            document.getElementById('btn-dice-start').disabled = false;
        }, 800);
    }

    // --- BLACKJACK LOGIC (ONLINE) ---
    let pHand = [], dHand = [], bjBet = 0, deck = [];
    async function startBJ() {
        bjBet = parseInt(document.getElementById('bj-bet').value);
        if(bjBet > userData.chips) return alert("M√°lo ≈æeton≈Ø!");
        userData.chips -= bjBet; updateUI();
        document.getElementById('bj-setup').classList.add('hidden');
        document.getElementById('bj-play').classList.remove('hidden');
        deck = []; ['2','3','4','5','6','7','8','9','10','J','Q','K','A'].forEach(v => ['‚ô†','‚ô•','‚ô¶','‚ô£'].forEach(s => deck.push({v,s})));
        deck.sort(() => Math.random()-0.5);
        pHand = [deck.pop(), deck.pop()]; dHand = [deck.pop(), deck.pop()];
        renderBJ(false);
    }
    function renderBJ(all) {
        document.getElementById('p-hand').innerHTML = pHand.map(c => `<div class="card">${c.v}${c.s}</div>`).join('');
        document.getElementById('d-hand').innerHTML = dHand.map((c,i) => `<div class="card" style="${!all && i===1?'background:#333':''}">${!all && i===1?'?':c.v+c.s}</div>`).join('');
    }
    function getVal(h) {
        let s = 0, a = 0;
        h.forEach(c => { if(['J','Q','K'].includes(c.v)) s+=10; else if(c.v==='A'){s+=11;a++;} else s+=parseInt(c.v); });
        while(s>21 && a>0){s-=10;a--;} return s;
    }
    async function bjAction(a) {
        if(a === 'hit') {
            pHand.push(deck.pop()); renderBJ(false);
            if(getVal(pHand) > 21) bjEnd(false, "P≈òET√ÅHL JSI!");
        } else {
            renderBJ(true);
            while(getVal(dHand) < 17) { dHand.push(deck.pop()); renderBJ(true); }
            let ps = getVal(pHand), ds = getVal(dHand);
            if(ds > 21 || ps > ds) bjEnd(true, "V√ùHRA!");
            else if(ps < ds) bjEnd(false, "PROHRA");
            else bjEnd('draw', "REMIZA");
        }
    }
    function bjEnd(res, m) {
        if(res === true) { userData.chips += bjBet * 2; play('win'); }
        else if(res === 'draw') userData.chips += bjBet;
        else play('lose');
        updateUI(); document.getElementById('status').innerText = m;
        document.getElementById('bj-setup').classList.remove('hidden');
        document.getElementById('bj-play').classList.add('hidden');
    }

    // --- ADMIN ---
    async function adminKey(e) {
        if(e.key === 'Enter') {
            const p = e.target.value.split(' ');
            if(p[0] === '/give') {
                const res = await fetch(DB_URL + ".json");
                const users = await res.json();
                if(users[p[1]]) {
                    users[p[1]].chips += parseInt(p[2]);
                    await fetch(`${DB_URL}/${p[1]}.json`, { method: 'PUT', body: JSON.stringify(users[p[1]]) });
                    alert("√öspƒõch!"); if(p[1] === currentUser) location.reload();
                }
            }
            e.target.value = '';
        }
    }
</script>
</body>
</html>
